var cookies;(function(e){"use strict";window.PUM_Admin=window.PUM_Admin||{},window.pum_popup_settings_editor=window.pum_popup_settings_editor||{form_args:{},current_values:{}},e(document).on("keydown","#popup-title",function(t){var i=t.keyCode||t.which;9===i&&(t.preventDefault(),e("#title").focus())}).on("keydown","#title, #popup-title",function(t){var i,n=t.keyCode||t.which;t.shiftKey||9!==n||(t.preventDefault(),i="title"===e(this).attr("id")?"#popup-title":"#insert-media-button",e(i).focus())}).on("keydown","#popup-title, #insert-media-button",function(t){var i,n=t.keyCode||t.which;t.shiftKey&&9===n&&(t.preventDefault(),i="popup-title"===e(this).attr("id")?"#title":"#popup-title",e(i).focus())}),e(function(){e(this).trigger("pum_init"),e("#title").prop("required",!0);var t=e("#pum-popup-settings-container"),i=pum_popup_settings_editor.form_args||{},n=pum_popup_settings_editor.current_values||{};t.length&&(t.find(".pum-no-js").hide(),PUM_Admin.forms.render(i,n,t)),e("a.page-title-action").clone().attr("target","_blank").attr("href",pum_admin_vars.homeurl+"?popup_preview=true&popup="+e("#post_ID").val()).text(pum_admin_vars.I10n.preview_popup).insertAfter("a.page-title-action"),e("#pum-first-condition, #pum-first-trigger, #pum-first-cookie").val(null).trigger("change"),document.querySelector("#pum-popup-settings-container").addEventListener("change",function(e){if("open_sound"===e.target.id){var t=["none","custom"];if(-1===t.indexOf(e.target.value)){var i=new Audio(pum_admin_vars.pm_dir_url+"/assets/sounds/"+e.target.value);i.addEventListener("canplaythrough",function(){this.play().catch(function(e){console.warn("Sound was not able to play when selected. Reason: "+e)})}),i.addEventListener("error",function(){console.warn("Error occurred when trying to load popup opening sound.")})}}}),e(document).on("pum_init",function(){e("#pum-default-click-trigger-class:not(.pum-click-trigger-initialized)").each(function(){e(this).addClass("pum-click-trigger-initialized").text(e("#popup-id").data("popup-id"))})}),document.querySelector("#pum-popup-settings-container").addEventListener("click",function(e){if(Array.from(e.target.classList).includes("popup-type")||Array.from(e.target.parentElement.classList).includes("popup-type")){var t=jQuery("#pum-popup-settings-container");if(1===t.length){var i={"center-popup":{size:"medium",responsive_min_width:"0%",responsive_max_width:"100%",animation_type:"fade",animation_speed:350,location:"center",position_fixed:!1,position_from_trigger:!1,overlay_disabled:!1,stackable:!1,disable_reposition:!1},"left-bottom-notice":{size:"tiny",responsive_min_width:"0%",responsive_max_width:"100%",animation_type:"fade",animation_speed:350,animation_origin:"left bottom",location:"left bottom",position_bottom:10,position_left:10,position_from_trigger:!1,position_fixed:!0,overlay_disabled:!0,stackable:!0,disable_reposition:!1},"top-bar":{size:"custom",custom_width:"100%",custom_height_auto:!0,animation_type:"fadeAndSlide",animation_speed:300,animation_origin:"top",location:"center top",position_top:0,position_from_trigger:!1,position_fixed:!0,overlay_disabled:!0,stackable:!0,disable_reposition:!1},"right-bottom-slidein":{size:"custom",custom_width:"300px",custom_height_auto:!0,animation_type:"slide",animation_speed:350,animation_origin:"bottom",location:"right bottom",position_bottom:10,position_right:10,position_from_trigger:!1,position_fixed:!0,overlay_disabled:!0,stackable:!0,disable_reposition:!1}},n=e.target.dataset.popupType||e.target.parentElement.dataset.popupType||"",o=i.hasOwnProperty(n)?i[n]:{},r=pum_popup_settings_editor.form_args||{},s=pum_popup_settings_editor.current_values||{},a=t.pumSerializeObject();if(a.popup_settings.triggers)for(var d=0;d<a.popup_settings.triggers.length;d++)a.popup_settings.triggers[d].settings=JSON.parse(a.popup_settings.triggers[d].settings);if(a.popup_settings.cookies)for(var p=0;p<a.popup_settings.cookies.length;p++)a.popup_settings.cookies[p].settings=JSON.parse(a.popup_settings.cookies[p].settings);var c=Object.assign({},s,a.popup_settings,o);PUM_Admin.forms.render(r,c,t),document.querySelector('a[href="#pum-popup-settings_display"]').click();var l=document.createElement("div");l.classList.add("notice","updated"),l.insertBefore(document.createElement("p"),l.firstChild),l.firstChild.innerText="Display settings have been updated with the "+n+" preset";var u=document.querySelector("#pum-popup-settings-display-subtabs_preset");u.insertBefore(l,u.firstChild)}}}),console.log("[DEBUG] Popup Settings: Remembering the active tab item ...");const o=".pum-tabs-container.pum-tabbed-form.vertical-tabs > ul.tabs .tab",r=document.querySelectorAll(o),s=e("#popup-id").data("popup-id");if(!r.length)return void console.log("[DEBUG] Popup Settings: No tab items found!");if(r.forEach(t=>{t.addEventListener("click",function(t){if(!t.target.hasAttribute("href"))return;sessionStorage.setItem(`${s}-active-tab`,t.target.getAttribute("href"));const i=t.target.getAttribute("href").split("_")[1],n=sessionStorage.getItem(`${s}-active-horz-tab_${i}`);if(n)console.log(`[PUM] selHorzItem = ${n}`),document.querySelector(".horizontal-tabs > ul.tabs .tab").classList.remove("active"),e(`a[href="${n}"]`).closest("li.tab").click(),document.querySelector(`a[href="${n}"]`).closest("li.tab").classList.add("active");else{let t=e(this),i=t.parents(".pum-tabs-container:first");i.find(".horizontal-tabs > ul.tabs > li.tab:first-child").addClass("active")}const o=e(t.target.getAttribute("href")+" .horizontal-tabs").data("tab-count");if(console.log(`[PUM] tabCount = ${o}`),o>1){const i=e(t.target.getAttribute("href")+" .horizontal-tabs > ul.tabs .tab");console.log("[PUM] horzTabs = ",i);const n=t.target.getAttribute("href").split("_")[1];i.click(e=>{e.target.hasAttribute("href")&&sessionStorage.setItem(`${s}-active-horz-tab_${n}`,e.target.getAttribute("href"))})}},!1)}),!sessionStorage.length)return;const a=sessionStorage.getItem(`${s}-active-tab`);if(!a)return;const d=a.split("_")[1];if(console.log(`currHorzTabName = ${d}`),a){const e=document.querySelector(`${o} > a[href="${a}"`);if(!e)return void console.log("[DEBUG] Popup Settings: Active tab item not found!");e.click(),e.classList.add("active")}const p=sessionStorage.getItem(`${s}-active-horz-tab_${d}`);p&&(console.log(`[PUM] selHorzItem = ${p}`),e(".horizontal-tabs > ul.tabs .tab").removeClass("active"),e(`a[href="${p}"]`).closest("li.tab").click(),e(`a[href="${p}"]`).closest("li.tab").addClass("active"))})})(jQuery),function(e,t,i){"use strict";e(t).on("click","#popup_reset_open_count",function(){var t=e(this);t.is(":checked")&&!confirm(pum_admin_vars.I10n.confirm_count_reset)&&t.prop("checked",!1)})}(jQuery,document),function(e){"use strict";var t={get_conditions:function(){return window.pum_popup_settings_editor.conditions_selectlist},not_operand_checkbox:function(i){return i=i||e(".pum-not-operand"),i.each(function(){var i=e(this),n=i.find("input");n.prop("checked",!n.is(":checked")),t.toggle_not_operand(i)})},toggle_not_operand:function(t){return t=t||e(".pum-not-operand"),t.each(function(){var t=e(this),i=t.find("input"),n=t.parents(".facet-target");i.is(":checked")?n.addClass("not-operand-checked"):n.removeClass("not-operand-checked")})},template:{editor:function(t){var i=e.extend(!0,{},{groups:[]},t);return i.groups=PUM_Admin.utils.object_to_array(i.groups),PUM_Admin.templates.render("pum-condition-editor",i)},group:function(t){var i,n=e.extend(!0,{},{index:"",facets:[]},t);for(n.facets=PUM_Admin.utils.object_to_array(n.facets),i=0;n.facets.length>i;i++)n.facets[i].index=i,n.facets[i].group=n.index;return PUM_Admin.templates.render("pum-condition-group",n)},facet:function(t){var i=e.extend(!0,{},{group:"",index:"",target:"",not_operand:!1,settings:{}},t);return PUM_Admin.templates.render("pum-condition-facet",i)},settings:function(t,i){var n=[],o=e.extend(!0,{},{index:"",group:"",target:null,fields:[]},t);return o.fields.length||void 0===pum_popup_settings_editor.conditions[t.target]||(o.fields=pum_popup_settings_editor.conditions[t.target].fields),void 0===i&&(i={}),_.each(o.fields,function(e,t){e=PUM_Admin.models.field(e),"object"!=typeof e.meta&&(e.meta={}),void 0!==i[t]&&(e.value=i[t]),e.name="popup_settings[conditions]["+o.group+"]["+o.index+"][settings]["+t+"]",""===e.id&&(e.id="popup_settings_conditions_"+o.group+"_"+o.index+"_settings_"+t),n.push(PUM_Admin.templates.field(e))}),PUM_Admin.templates.section({fields:n})},selectbox:function(i){var n=e.extend(!0,{},{id:null,name:null,type:"select",group:"",index:"",value:null,select2:!0,classes:[],options:t.get_conditions()},i);return null===n.id&&(n.id="popup_settings_conditions_"+n.group+"_"+n.index+"_target"),null===n.name&&(n.name="popup_settings[conditions]["+n.group+"]["+n.index+"][target]"),PUM_Admin.templates.field(n)}},groups:{add:function(i,n,o){var r=e(i),s={index:r.find(".facet-group-wrap").length,facets:[{target:n||null,not_operand:o||!1,settings:{}}]};r.find(".facet-groups").append(t.template.group(s)),r.addClass("has-conditions")},remove:function(i){var n=i.parents(".facet-builder");i.prev(".facet-group-wrap").find(".and .add-facet").removeClass("disabled"),i.remove(),t.renumber(),0===n.find(".facet-group-wrap").length&&(n.removeClass("has-conditions"),e("#pum-first-condition").val(null).trigger("change"))}},facets:{add:function(e,i,n){var o={group:e.data("index"),index:e.find(".facet").length,target:i||null,not_operand:n||!1,settings:{}};e.find(".facet-list").append(t.template.facet(o))},remove:function(e){var i=e.parents(".facet-group-wrap");e.remove(),0===i.find(".facet").length?t.groups.remove(i):t.renumber()}},renumber:function(){e(".facet-builder .facet-group-wrap").each(function(){var t=e(this),i=t.parent().children().index(t);t.data("index",i).find(".facet").each(function(){var t=e(this),n=t.parent().children().index(t);t.data("index",n).find("[name]").each(function(){this.name=this.name.replace(/popup_settings\[conditions\]\[\d*?\]\[\d*?\]/,"popup_settings[conditions]["+i+"]["+n+"]"),this.id=this.id.replace(/popup_settings_conditions_\d*?_\d*?_/,"popup_settings_conditions_"+i+"_"+n+"_")})})})}};window.PUM_Admin=window.PUM_Admin||{},window.PUM_Admin.conditions=t,e(document).on("pum_init",function(){t.renumber(),t.toggle_not_operand()}).on("select2:select pumselect2:select","#pum-first-condition",function(i){var n=e(this),o=n.parents(".facet-builder").eq(0),r=n.val(),s=o.find("#pum-first-facet-operand"),a=s.is(":checked");t.groups.add(o,r,a),n.val(null).trigger("change"),s.prop("checked",!1).parents(".facet-target").removeClass("not-operand-checked"),e(document).trigger("pum_init")}).on("click",".facet-builder .pum-not-operand",function(){t.not_operand_checkbox(e(this))}).on("change",".facet-builder .facet-target select",function(i){var n=e(this),o=n.parents(".facet"),r=n.val(),s={target:r};""!==r&&r!==o.data("target")&&(o.data("target",r).find(".facet-settings").html(t.template.settings(s)),e(document).trigger("pum_init"))}).on("click",".facet-builder .facet-group-wrap:last-child .and .add-facet",function(){t.groups.add(e(this).parents(".facet-builder").eq(0)),e(document).trigger("pum_init")}).on("click",".facet-builder .add-or .add-facet:not(.disabled)",function(){t.facets.add(e(this).parents(".facet-group-wrap").eq(0)),e(document).trigger("pum_init")}).on("click",".facet-builder .remove-facet",function(){t.facets.remove(e(this).parents(".facet").eq(0)),e(document).trigger("pum_init")})}(jQuery),function(e,t,i){"use strict";var n,o=pum_admin_vars.I10n,r={get_cookies:function(){return window.pum_popup_settings_editor.cookies},get_cookie:function(e){var t=this.get_cookies(),i="undefined"!==t[e]&&t[e];return!!i&&(i&&"object"==typeof i&&"object"==typeof i.fields&&Object.keys(i.fields).length&&(i=this.parseFields(i)),i)},getCookieDefaults:function(t){var i=r.get_cookie(t),n={};for(var o in i.fields)if(i.fields.hasOwnProperty(o))for(var s in i.fields[o])i.fields[o].hasOwnProperty(s)&&(n[s]=i.fields[o][s].std);return n.name="pum-"+e("#post_ID").val(),n},parseFields:function(e){return _.each(e.fields,function(t,i){_.each(t,function(t,n){e.fields[i][n].name="cookie_settings["+n+"]",""===e.fields[i][n].id&&(e.fields[i][n].id="cookie_settings_"+n)})}),e},parseValues:function(e,t){return e},select_list:function(){var e,t=PUM_Admin.utils.object_to_array(r.get_cookies()),i={};for(e=0;e<t.length;e++)i[t[e].id]=t[e].name;return i},getLabel:function(e){var t=r.get_cookie(e);return!!t&&t.name},getSettingsDesc:function(e,t){var i=r.get_cookie(e);return!!i&&PUM_Admin.templates.renderInline(i.settings_column,t)},refreshDescriptions:function(){e(".pum-popup-cookie-editor table.list-table tbody tr").each(function(){var t=e(this),i=t.find(".popup_cookies_field_event").val(),n=JSON.parse(t.find(".popup_cookies_field_settings:first").val());t.find("td.settings-column").html(r.getSettingsDesc(i,n))})},insertCookie:function(t,i){var n=r.getCookieDefaults(i.event);i=e.extend(!0,{},{event:"on_popup_close",settings:n},i),r.rows.add(t,i)},template:{form:function(t,i,n){var s=r.get_cookie(t),a="pum_cookie_settings",d=Object.keys(s.fields)[0];i=i||{},i.event=t,i.index=i.index>=0?i.index:null,s.fields[d]=e.extend(!0,s.fields[d],{index:{type:"hidden",name:"index"},event:{type:"hidden",name:"event"}}),"string"==typeof i.key&&""!==i.key||delete s.fields.advanced.key,PUM_Admin.modals.reload("#"+a,PUM_Admin.templates.modal({id:a,title:s.modal_title||s.name,classes:"tabbed-content",save_button:null!==i.index?o.update:o.add,content:PUM_Admin.forms.render({id:"pum_cookie_settings_form",tabs:s.tabs||{},fields:s.fields||{}},i||{})})),e("#"+a+" form").on("submit",n||function(e){e.preventDefault(),PUM_Admin.modals.closeAll()})},editor:function(t){var i=e.extend(!0,{},{cookies:[],name:""},t);return i.cookies=PUM_Admin.utils.object_to_array(i.cookies),PUM_Admin.templates.render("pum-cookie-editor",i)},row:function(t){var i=e.extend(!0,{},{index:"",event:"",name:"",settings:{name:"",key:"",session:null,path:null,time:"30 days"}},t);return PUM_Admin.templates.render("pum-cookie-row",i)},selectbox:function(t){var i=e.extend(!0,{},{id:null,name:null,type:"select",group:"",index:"",value:null,select2:!0,classes:[],options:r.select_list()},t);return null===i.id&&(i.id="popup_settings_cookies_"+i.index+"_event"),null===i.name&&(i.name="popup_settings[cookies]["+i.index+"][event]"),PUM_Admin.templates.field(i)}},rows:{add:function(t,i){var n=e(t),o={index:null!==i.index&&i.index>=0?i.index:n.find("table.list-table tbody tr").length,event:i.event,name:n.data("field_name"),settings:i.settings||{}},s=n.find("tbody tr").eq(o.index),a=PUM_Admin.templates.render("pum-cookie-row",o);s.length?s.replaceWith(a):n.find("tbody").append(a),n.addClass("has-list-items"),r.rows.renumber(),r.refreshDescriptions()},remove:function(t){var i=t.parents(".pum-popup-cookie-editor");t.remove(),r.rows.renumber(),0===i.find("table.list-table tbody tr").length&&(i.removeClass("has-list-items"),e("#pum-first-cookie").val(null).trigger("change"))},renumber:function(){e(".pum-popup-cookie-editor table.list-table tbody tr").each(function(){var t=e(this),i=t.parent().children().index(t);t.attr("data-index",i).data("index",i),t.find(":input, [name]").each(function(){this.name&&""!==this.name&&(this.name=this.name.replace(/\[\d*?\]/,"["+i+"]"))})})}}};window.PUM_Admin=window.PUM_Admin||{},window.PUM_Admin.cookies=r,e(t).on("pum_init",function(){r.refreshDescriptions()}).on("select2:select pumselect2:select","#pum-first-cookie",function(){var t=e(this),i=t.parents(".pum-popup-cookie-editor"),n=t.val(),o={indes:i.find("table.list-table tbody tr").length,name:"pum-"+e("#post_ID").val()};t.val(null).trigger("change"),r.template.form(n,o,function(t){var n=e(this),o=n.find("input#event").val(),s=n.find("input#index").val(),a=n.pumSerializeObject();t.preventDefault(),(!s||s<0)&&(s=i.find("tbody tr").length),r.rows.add(i,{index:s,event:o,settings:a.cookie_settings}),PUM_Admin.modals.closeAll()})}).on("click",".pum-popup-cookie-editor .pum-add-new",function(){n=e(this).parents(".pum-popup-cookie-editor");var t=wp.template("pum-cookie-add-event");PUM_Admin.modals.reload("#pum_cookie_add_event_modal",t({I10n:o}))}).on("click",".pum-popup-cookie-editor .edit",function(t){var i=e(this),n=i.parents(".pum-popup-cookie-editor"),o=i.parents("tr:first"),s=o.find(".popup_cookies_field_event").val(),a=_.extend({},JSON.parse(o.find(".popup_cookies_field_settings:first").val()),{index:o.parent().children().index(o),event:s});t.preventDefault(),r.template.form(s,a,function(t){var i=e(this),o=i.find("input#event").val(),s=i.find("input#index").val(),a=i.pumSerializeObject();t.preventDefault(),(!1===s||s<0)&&(s=n.find("tbody tr").length),r.rows.add(n,{index:s,event:o,settings:a.cookie_settings}),PUM_Admin.modals.closeAll()})}).on("click",".pum-popup-cookie-editor .remove",function(t){var i=e(this),n=i.parents("tr:first");t.preventDefault(),window.confirm(o.confirm_delete_cookie)&&r.rows.remove(n)}).on("click",".pum-field-cookie_key button.reset",function(t){var i=e(this),n=(new Date).getTime().toString(16);i.siblings('input[type="text"]:first').val(n)}).on("submit","#pum_cookie_add_event_modal .pum-form",function(t){var i=n,o=e("#popup_cookie_add_event").val(),s={index:i.find("table.list-table tbody tr").length,name:"pum-"+e("#post_ID").val(),path:"1"};t.preventDefault(),r.template.form(o,s,function(t){var n=e(this),o=n.find("input#event").val(),s=n.find("input#index").val(),a=n.pumSerializeObject();if(t.preventDefault(),(!1===s||s<0)&&(s=i.find("tbody tr").length),r.rows.add(i,{index:s,event:o,settings:a.cookie_settings}),PUM_Admin.modals.closeAll(),void 0!==PUM_Admin.triggers&&!1!==PUM_Admin.triggers.new_cookie&&PUM_Admin.triggers.new_cookie>=0){var d=PUM_Admin.triggers.current_editor.find("tbody tr").eq(PUM_Admin.triggers.new_cookie).find(".popup_triggers_field_settings:first"),p=JSON.parse(d.val());"string"==typeof p.cookie_name?p.cookie_name=p.cookie_name.replace("add_new",a.cookie_settings.name):(p.cookie_name[p.cookie_name.indexOf("add_new")]=a.cookie_settings.name,p.cookie_name=p.cookie_name.filter(function(e,t,i){return!(e in this)&&(this[e]=!0)},{})),d.val(JSON.stringify(p)),PUM_Admin.triggers.new_cookie=!1,PUM_Admin.triggers.refreshDescriptions()}})})}(jQuery,document),function(e,t,i){"use strict";var n=pum_admin_vars.I10n,o={current_editor:null,new_cookie:!1,get_triggers:function(){return window.pum_popup_settings_editor.triggers},get_trigger:function(e){var t=this.get_triggers(),i="undefined"!==t[e]&&t[e];return!!i&&(i&&"object"==typeof i&&"object"==typeof i.fields&&Object.keys(i.fields).length&&(i=this.parseFields(i)),i)},parseFields:function(e){return _.each(e.fields,function(t,i){_.each(t,function(t,n){e.fields[i][n].name="trigger_settings["+n+"]",""===e.fields[i][n].id&&(e.fields[i][n].id="trigger_settings_"+n)})}),e},parseValues:function(e,t){for(var i in e)e.hasOwnProperty(i)&&e.hasOwnProperty(i+"_unit")&&(e[i]+=e[i+"_unit"],delete e[i+"_unit"]);return e},select_list:function(){var e,t=PUM_Admin.utils.object_to_array(o.get_triggers()),i={};for(e=0;e<t.length;e++)i[t[e].id]=t[e].name;return i},rows:{add:function(t,i){var n=e(t),r={index:null!==i.index&&i.index>=0?i.index:n.find("table.list-table tbody tr").length,type:i.type,name:n.data("field_name"),settings:i.settings||{}},s=n.find("tbody tr").eq(r.index),a=PUM_Admin.templates.render("pum-trigger-row",r);s.length?s.replaceWith(a):n.find("tbody").append(a),n.addClass("has-list-items"),o.renumber(),o.refreshDescriptions()},remove:function(t){var i=t.parents(".pum-popup-trigger-editor");t.remove(),o.renumber(),0===i.find("table.list-table tbody tr").length&&(i.removeClass("has-list-items"),e("#pum-first-trigger").val(null).trigger("change"))}},template:{form:function(t,i,r){var s=o.get_trigger(t),a="pum_trigger_settings",d=Object.keys(s.fields)[0],p=e(".pum-field-cookies .list-table tbody tr");i=i||{},i.type=t,i.index=i.index>=0?i.index:null,s.fields[d]=e.extend(!0,s.fields[d],{index:{type:"hidden",name:"index"},type:{type:"hidden",name:"type"}}),p.each(function(){var t=JSON.parse(e(this).find(".popup_cookies_field_settings:first").val());void 0===s.fields[d].cookie_name.options[t.name]&&(s.fields[d].cookie_name.options[t.name]=t.name)}),PUM_Admin.modals.reload("#"+a,PUM_Admin.templates.modal({id:a,title:s.modal_title||s.name,classes:"tabbed-content",save_button:null!==i.index?n.update:n.add,content:PUM_Admin.forms.render({id:"pum_trigger_settings_form",tabs:s.tabs||{},fields:s.fields||{}},i||{})})),e("#"+a+" form").on("submit",r||function(e){e.preventDefault(),PUM_Admin.modals.closeAll()})},editor:function(t){var i=e.extend(!0,{},{triggers:[],name:""},t);return i.triggers=PUM_Admin.utils.object_to_array(i.triggers),PUM_Admin.templates.render("pum-trigger-editor",i)},row:function(t){var i=e.extend(!0,{},{index:"",type:"",name:"",settings:{cookie_name:""}},t);return PUM_Admin.templates.render("pum-trigger-row",i)},selectbox:function(t){var i=e.extend(!0,{},{id:null,name:null,type:"select",group:"",index:"",value:null,select2:!0,classes:[],options:o.select_list()},t);return null===i.id&&(i.id="popup_settings_triggers_"+i.index+"_type"),null===i.name&&(i.name="popup_settings[triggers]["+i.index+"][type]"),PUM_Admin.templates.field(i)}},getLabel:function(e){var t=o.get_trigger(e);return!!t&&t.name},getSettingsDesc:function(e,t){var i=o.get_trigger(e);return!!i&&PUM_Admin.templates.renderInline(i.settings_column,t)},renumber:function(){e(".pum-popup-trigger-editor table.list-table tbody tr").each(function(){var t=e(this),i=t.parent().children().index(t);t.attr("data-index",i).data("index",i),t.find(":input, [name]").each(function(){this.name&&""!==this.name&&(this.name=this.name.replace(/\[\d*?\]/,"["+i+"]"))})})},refreshDescriptions:function(){e(".pum-popup-trigger-editor table.list-table tbody tr").each(function(){var t=e(this),i=t.find(".popup_triggers_field_type").val(),n=JSON.parse(t.find(".popup_triggers_field_settings:first").val()),o=PUM_Admin.triggers.cookie_column_value(n.cookie_name);t.find("td.settings-column").html(PUM_Admin.triggers.getSettingsDesc(i,n)),t.find("td.cookie-column code").text(o)})},cookie_column_value:function(e){var t=n.no_cookie;return e instanceof Array?t=e.join(", "):null!==e&&e!==i&&""!==e&&(t=e),t},append_click_selector_presets:function(){var t,i,n=e("#extra_selectors");n.length&&!n.hasClass("pum-click-selector-presets-initialized")&&(t=PUM_Admin.templates.render("pum-click-selector-presets"),i=n.parents(".pum-field").find(".pum-click-selector-presets"),i.length||(n.before(t),n.addClass("pum-click-selector-presets-initialized"),i=n.parents(".pum-field").find(".pum-click-selector-presets")),i.position({my:"right center",at:"right center",of:n}))},toggle_click_selector_presets:function(){e(this).parent().toggleClass("open")},reset_click_selector_presets:function(t){t!==i&&e(t.target).parents(".pum-click-selector-presets").length||e(".pum-click-selector-presets").removeClass("open")},insert_click_selector_preset:function(){var t=e(this),i=e("#extra_selectors"),n=i.val();""!==n&&(n+=", "),i.val(n+t.data("preset")),PUM_Admin.triggers.reset_click_selector_presets()}};window.PUM_Admin=window.PUM_Admin||{},window.PUM_Admin.triggers=o,e(t).on("pum_init",function(){PUM_Admin.triggers.append_click_selector_presets(),PUM_Admin.triggers.refreshDescriptions()}).on("click",".pum-click-selector-presets > span",PUM_Admin.triggers.toggle_click_selector_presets).on("click",".pum-click-selector-presets li",PUM_Admin.triggers.insert_click_selector_preset).on("click",PUM_Admin.triggers.reset_click_selector_presets).on("select2:select pumselect2:select","#pum-first-trigger",function(){var t=e(this),n=t.parents(".pum-popup-trigger-editor"),r=t.val(),s={};PUM_Admin.triggers.current_editor=n,"click_open"!==r&&(s.cookie_name="pum-"+e("#post_ID").val()),o.template.form(r,s,function(t){var r=e(this),s=r.find("input#type").val(),a=r.pumSerializeObject(),d=o.parseValues(a.trigger_settings||{}),p=parseInt(a.index);t.preventDefault(),(!1===p||p<0)&&(p=n.find("tbody tr").length),o.rows.add(n,{index:p,type:s,settings:d}),PUM_Admin.modals.closeAll(),d.cookie_name!==i&&null!==d.cookie_name&&("add_new"===d.cookie_name||d.cookie_name.indexOf("add_new")>=0)&&(PUM_Admin.triggers.new_cookie=a.index,e("#pum-popup-settings-container .pum-popup-cookie-editor button.pum-add-new").trigger("click"))}),t.val(null).trigger("change")}).on("click",".pum-popup-trigger-editor .pum-add-new",function(){PUM_Admin.triggers.current_editor=e(this).parents(".pum-popup-trigger-editor");var t=wp.template("pum-trigger-add-type");PUM_Admin.modals.reload("#pum_trigger_add_type_modal",t({I10n:n}))}).on("click",".pum-popup-trigger-editor .edit",function(t){var n=e(this),r=n.parents(".pum-popup-trigger-editor"),s=n.parents("tr:first"),a=s.find(".popup_triggers_field_type").val(),d=_.extend({},JSON.parse(s.find(".popup_triggers_field_settings:first").val()),{index:s.parent().children().index(s),type:a});t.preventDefault(),o.template.form(a,d,function(t){var n=e(this),s=n.find("input#type").val(),a=n.find("input#index").val(),d=n.pumSerializeObject(),p=o.parseValues(d.trigger_settings||{});PUM_Admin.triggers.current_editor=r,t.preventDefault(),(!1===a||a<0)&&(a=r.find("tbody tr").length),o.rows.add(r,{index:a,type:s,settings:p}),PUM_Admin.modals.closeAll(),p.cookie_name!==i&&null!==p.cookie_name&&("add_new"===p.cookie_name||p.cookie_name.indexOf("add_new")>=0)&&(PUM_Admin.triggers.new_cookie=d.index,e("#pum-popup-settings-container .pum-popup-cookie-editor button.pum-add-new").trigger("click"))})}).on("click",".pum-popup-trigger-editor .remove",function(t){var i=e(this),r=i.parents(".pum-popup-trigger-editor"),s=i.parents("tr:first");PUM_Admin.triggers.current_editor=r,t.preventDefault(),window.confirm(n.confirm_delete_trigger)&&o.rows.remove(s)}).on("submit","#pum_trigger_add_type_modal .pum-form",function(t){var n=PUM_Admin.triggers.current_editor,r=n.parents("#pum-popup-settings-triggers-subtabs_main").find(".pum-field-cookies .pum-popup-cookie-editor"),s=e("#popup_trigger_add_type").val(),a=e("#popup_trigger_add_cookie").is(":checked"),d=e("#popup_trigger_add_cookie_event").val(),p={};t.preventDefault(),a&&(p.cookie_name="pum-"+e("#post_ID").val(),PUM_Admin.cookies.insertCookie(r,{event:d,settings:{time:"1 month",path:"1",name:p.cookie_name}})),o.template.form(s,p,function(t){var r=e(this),s=r.find("input#type").val(),a=r.pumSerializeObject(),d=o.parseValues(a.trigger_settings||{}),p=parseInt(a.index);PUM_Admin.triggers.current_editor=n,t.preventDefault(),(!p||p<0)&&(p=n.find("tbody tr").length),o.rows.add(n,{index:p,type:s,settings:d}),PUM_Admin.modals.closeAll(),d.cookie_name!==i&&null!==d.cookie_name&&("add_new"===d.cookie_name||d.cookie_name.indexOf("add_new")>=0)&&(PUM_Admin.triggers.new_cookie=a.index,e("#pum-popup-settings-container .pum-popup-cookie-editor button.pum-add-new").trigger("click"))})})}(jQuery,document);